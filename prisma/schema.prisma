// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// 1. ìœ ì € ëª¨ë¸ (User)
// --------------------------------------
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  image         String?
  
  // ğŸ‘‡ ìœ ì €ì˜ ëª¨êµ­ì–´(ì¸í„°í˜ì´ìŠ¤ ì–¸ì–´) ì„¤ì •
  // í•œêµ­ì¸(KO)ì´ë©´ í•´ì„¤ì´ í•œêµ­ì–´ë¡œ, ë¯¸êµ­ì¸(EN)ì´ë©´ ì˜ì–´ë¡œ ë‚˜ê°
  nativeLang    Language  @default(KO) 
  
  // ëª©í‘œ ê¸‰ìˆ˜ (N1)
  targetLevel   Int       @default(1)

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  reviewNotes   ReviewNote[]
  solveHistory  SolveHistory[]
}

// --------------------------------------
// 2. ë¬¸ì œ ëª¨ë¸ (Problem) - i18n ì ìš©
// --------------------------------------
model Problem {
  id          Int            @id @default(autoincrement())
  
  level       Int            // 1(N1), 2(N2)...
  type        ProblemType    // READING, LISTENING...
  subType     ProblemSubType // ì„¸ë¶€ ìœ í˜•
  language  Language       // ë¬¸ì œ ì¶œì œ ì–¸ì–´ (ì¼ë³¸ì–´ ê³ ì •)
  
  // [ë‹¤êµ­ì–´ ì§€ì› í•„ë“œ] String -> Json ë³€ê²½
  // ë°ì´í„° êµ¬ì¡°: { "ko": "ë‚´ìš©", "en": "Content", "jp": "å†…å®¹" }
  
  // 1. ë°œë¬¸ (ë¬¸ì œ ì§ˆë¬¸)
  // ì˜ˆ: { "jp": "ç­†è€…ã®ä¸»å¼µã¯ä½•ã‹", "ko": "í•„ìì˜ ì£¼ì¥ì€ ë¬´ì—‡ì¸ê°€?", "en": "What is the author's main point?" }
  question    Json

  // 2. ë³´ê¸° (ì„ íƒì§€)
  // JLPT ë³´ê¸°ëŠ” ë³´í†µ ì¼ë³¸ì–´ ê·¸ëŒ€ë¡œì§€ë§Œ, ì´ˆê¸‰(N5)ì´ë‚˜ ì„¤ëª…ì´ í•„ìš”í•œ ê²½ìš° ë²ˆì—­ì´ í•„ìš”í•  ìˆ˜ ìˆìŒ
  // êµ¬ì¡°: [ { "id": 1, "text": { "jp": "A", "ko": "A(í•œêµ­ì–´)", "en": "A(English)" } }, ... ]
  options     Json           
  
  // 3. í•´ì„¤
  // ì˜ˆ: { "ko": "ì´ ë¬¸ë²•ì€ ì—­ì ‘ì„ ë‚˜íƒ€ë‚´ë©°...", "en": "This grammar point indicates contrast..." }
  explanation Json           

  content     Json           

  vocab       Json?          

  grammar     Json?          

  answerIndex Int            // ì •ë‹µ ì¸ë±ìŠ¤ (0~3)
  
  audioUrl    String?        // ì²­í•´ MP3 (S3 URL)
  imageUrl    String?        // ìë£Œ ì‚¬ì§„ (S3 URL)
  reasoning_for_level String? // ë‚œì´ë„ ì„ ì • ê·¼ê±°

  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  histories   SolveHistory[]
  reviews     ReviewNote[]
}

model ReviewNote {
  id        Int      @id @default(autoincrement())
  memo      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  problemId Int
  problem   Problem  @relation(fields: [problemId], references: [id])
  @@unique([userId, problemId])
}

model SolveHistory {
  id         Int      @id @default(autoincrement())
  isCorrect  Boolean
  userAnswer String? 
  timeTaken  Int?     
  createdAt  DateTime @default(now())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  problemId  Int
  problem    Problem  @relation(fields: [problemId], references: [id])
}


// ì§€ì›í•  ì–¸ì–´ ëª©ë¡ (í™•ì¥ ê°€ëŠ¥)
enum Language {
  KO // í•œêµ­ì–´
  EN // ì˜ì–´
  JP // ì¼ë³¸ì–´ (ì›ë¬¸ í‘œì‹œìš©)
  CN // ì¤‘êµ­ì–´ (ë¯¸ë˜ í™•ì¥)
  VN // ë² íŠ¸ë‚¨ì–´ (ë¯¸ë˜ í™•ì¥)
}

enum ProblemType {
  VOCAB
  GRAMMAR
  READING
  LISTENING
}

enum ProblemSubType {
  KANJI_READING
  ORTHOGRAPHY
  WORD_FORMATION
  CONTEXT
  PARAPHRASE
  USAGE
  GRAMMAR_FORM
  GRAMMAR_ORDER
  TEXT_GRAMMAR
  SHORT_PASSAGE
  MID_PASSAGE
  LONG_PASSAGE
  INTEGRATED_PASSAGE
  THEMATIC_PASSAGE
  INFO_RETRIEVAL
  TASK_BASED
  POINT_COMPREHENSION
  SUMMARY
  QUICK_RESPONSE
  INTEGRATED_COMPREHENSION
}